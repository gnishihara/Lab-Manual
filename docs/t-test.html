<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 t 検定 | データ解析マニュアル</title>
<meta name="author" content="水圏植物生態学研究室">
<meta name="description" content="6.1 必要なパッケージ library(tidyverse) library(readxl) library(broom)  6.2 データの準備 Rの iris8 データで解析を紹介します。 iris は data.frame として定義されているので、as_tibble() を使って tibble のクラスを追加します。 iris = iris |&gt; as_tibble() iris...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 6 t 検定 | データ解析マニュアル">
<meta property="og:type" content="book">
<meta property="og:description" content="6.1 必要なパッケージ library(tidyverse) library(readxl) library(broom)  6.2 データの準備 Rの iris8 データで解析を紹介します。 iris は data.frame として定義されているので、as_tibble() を使って tibble のクラスを追加します。 iris = iris |&gt; as_tibble() iris...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 6 t 検定 | データ解析マニュアル">
<meta name="twitter:description" content="6.1 必要なパッケージ library(tidyverse) library(readxl) library(broom)  6.2 データの準備 Rの iris8 データで解析を紹介します。 iris は data.frame として定義されているので、as_tibble() を使って tibble のクラスを追加します。 iris = iris |&gt; as_tibble() iris...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.12/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">データ解析マニュアル</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">このマニュアルについて</a></li>
<li><a class="" href="data-input.html"><span class="header-section-number">1</span> データの読み込み</a></li>
<li><a class="" href="data-wrangling.html"><span class="header-section-number">2</span> データの処理</a></li>
<li><a class="" href="data-logger-input.html"><span class="header-section-number">3</span> ロガーからの読み込み</a></li>
<li><a class="" href="data-summary.html"><span class="header-section-number">4</span> データの集計</a></li>
<li><a class="" href="map-function.html"><span class="header-section-number">5</span> map 関数ってすごい</a></li>
<li><a class="active" href="t-test.html"><span class="header-section-number">6</span> t 検定</a></li>
<li><a class="" href="anova.html"><span class="header-section-number">7</span> 分散分析</a></li>
<li><a class="" href="glm.html"><span class="header-section-number">8</span> 一般化線形モデル</a></li>
<li><a class="" href="gam.html"><span class="header-section-number">9</span> 一般化加法モデル</a></li>
<li><a class="" href="model-selection.html"><span class="header-section-number">10</span> モデル選択</a></li>
<li><a class="" href="ggplot.html"><span class="header-section-number">11</span> ggplot</a></li>
<li><a class="" href="maps.html"><span class="header-section-number">12</span> 地図の作り方</a></li>
<li><a class="" href="wavelet.html"><span class="header-section-number">13</span> Wavlet 解析</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/gnishihara/Lab-Manual">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="t-test" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> t 検定<a class="anchor" aria-label="anchor" href="#t-test"><i class="fas fa-link"></i></a>
</h1>
<div id="必要なパッケージ-5" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> 必要なパッケージ<a class="anchor" aria-label="anchor" href="#%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8-5"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="データの準備-2" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> データの準備<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E6%BA%96%E5%82%99-2"><i class="fas fa-link"></i></a>
</h2>
<p>Rの <code>iris</code><a href="wavelet.html#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a> データで解析を紹介します。
<code>iris</code> は <code>data.frame</code> として定義されているので、<code><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble()</a></code> を使って <code>tibble</code> のクラスを追加します。</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris</span> <span class="op">=</span> <span class="va">iris</span> |&gt; <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">iris</span>
<span class="co">#&gt; # A tibble: 150 × 5</span>
<span class="co">#&gt;    Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt;           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  </span>
<span class="co">#&gt;  1          5.1         3.5          1.4         0.2 setosa </span>
<span class="co">#&gt;  2          4.9         3            1.4         0.2 setosa </span>
<span class="co">#&gt;  3          4.7         3.2          1.3         0.2 setosa </span>
<span class="co">#&gt;  4          4.6         3.1          1.5         0.2 setosa </span>
<span class="co">#&gt;  5          5           3.6          1.4         0.2 setosa </span>
<span class="co">#&gt;  6          5.4         3.9          1.7         0.4 setosa </span>
<span class="co">#&gt;  7          4.6         3.4          1.4         0.3 setosa </span>
<span class="co">#&gt;  8          5           3.4          1.5         0.2 setosa </span>
<span class="co">#&gt;  9          4.4         2.9          1.4         0.2 setosa </span>
<span class="co">#&gt; 10          4.9         3.1          1.5         0.1 setosa </span>
<span class="co">#&gt; # … with 140 more rows</span></code></pre></div>
<p><code>iris</code>には4つの数値データと1つの文字列データが入っています。</p>
<p>このデータを可視化してから、解析します。</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris</span> |&gt; <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"Sepal|Petal"</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">name</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"part"</span>, <span class="st">"measurement"</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Species</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">Species</span><span class="op">)</span>,
             position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html">position_jitter</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_d</a></span><span class="op">(</span>end <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">part</span><span class="op">)</span>,
             cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">measurement</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="20-analysis-ttest_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;"></div>
</div>
<div id="petal-と-sepal-の長さの比較" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Petal と Sepal の長さの比較<a class="anchor" aria-label="anchor" href="#petal-%E3%81%A8-sepal-%E3%81%AE%E9%95%B7%E3%81%95%E3%81%AE%E6%AF%94%E8%BC%83"><i class="fas fa-link"></i></a>
</h2>
<p>種を無視して、アヤメの Petal （花びら）と Sepal (萼片)の長さを比較しています。</p>
<p>花びらと萼片の平均値、標準偏差、標準誤差を先にもとめます。
専用の標準誤差の関数はないので、ここで定義します。</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">se</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">irisout</span> <span class="op">=</span> <span class="va">iris</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"Length"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">mean</span>, sd <span class="op">=</span> <span class="va">sd</span>, se <span class="op">=</span> <span class="va">se</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">irisout</span>
<span class="co">#&gt; # A tibble: 1 × 6</span>
<span class="co">#&gt;   Sepal.Length_mean Sepal.Length_sd Sepal.Length_se</span>
<span class="co">#&gt;               &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1              5.84           0.828          0.0676</span>
<span class="co">#&gt; # … with 3 more variables: Petal.Length_mean &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Petal.Length_sd &lt;dbl&gt;, Petal.Length_se &lt;dbl&gt;</span></code></pre></div>
<ul>
<li>H<sub>0</sub>: 花びらと萼片の長さに違いがない</li>
<li>H<sub>A</sub>: 花びらと萼片の長さに違いがある</li>
</ul>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Petal.Length</span>, <span class="va">iris</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Welch Two Sample t-test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  iris$Petal.Length and iris$Sepal.Length</span>
<span class="co">#&gt; t = -13.098, df = 211.54, p-value &lt; 2.2e-16</span>
<span class="co">#&gt; alternative hypothesis: true difference in means is not equal to 0</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  -2.399166 -1.771500</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; mean of x mean of y </span>
<span class="co">#&gt;  3.758000  5.843333</span></code></pre></div>
<p>t検定は <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code> で実施します。
関数の出力には、使用したデータ、t値、 自由度、 P値、平均値の差の95%信頼区間、それぞれの平均値の推定量が返ってきました。
結論から説明すると、P &lt; 0.0001 なので、有意水準が 0.05 のとき、帰無仮説は棄却できます。</p>
<p><code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code> の結果をオブジェクトに書き込んだら、t値 (t value)、p値 (p value)、自由度 (degrees of freedom) を抽出できます。</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dset_test</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Petal.Length</span>, <span class="va">iris</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span>
<span class="va">dset_test</span><span class="op">$</span><span class="va">statistic</span>  <span class="co"># t value</span>
<span class="co">#&gt;         t </span>
<span class="co">#&gt; -13.09835</span>
<span class="va">dset_test</span><span class="op">$</span><span class="va">parameter</span>  <span class="co"># degrees of freedom </span>
<span class="co">#&gt;       df </span>
<span class="co">#&gt; 211.5427</span>
<span class="va">dset_test</span><span class="op">$</span><span class="va">p.value</span> 　 <span class="co"># p value</span>
<span class="co">#&gt; [1] 4.262173e-29</span></code></pre></div>
<p>英語論文に記述する場合は、次の通りです。</p>
<blockquote>
<p>The mean petal length of the samples was 3.76 ± 0.14, whereas the mean sepal length was 5.84 ± 0.07.
A Welch’S t-test revealed that there was statistical significance in the differences between the two sites (t<sub>(211.54)</sub> = -13.098; P &lt; 0.0001) at a significance level of <span class="math inline">\(\alpha=\)</span> 0.05.</p>
</blockquote>
<p>大事なポイントは、この 3 つの情報を報告することです。</p>
<ul>
<li>t<sub>(211.54)</sub>: 検定に使用した自由度（サンプル数の目安）</li>
<li>-13.098: t検定の統計量</li>
<li>P = 0.0000: 結果のP値</li>
</ul>
</div>
<div id="petal-と-sepal-の幅の比較" class="section level2" number="6.4">
<h2>
<span class="header-section-number">6.4</span> Petal と Sepal の幅の比較<a class="anchor" aria-label="anchor" href="#petal-%E3%81%A8-sepal-%E3%81%AE%E5%B9%85%E3%81%AE%E6%AF%94%E8%BC%83"><i class="fas fa-link"></i></a>
</h2>
<p>先程の説明は横長のでデータ解析でしたが、<code>tidy</code> データ（縦長）の場合、もっと簡易に検定のコードをくめます。
まず、データを縦長に変換します。</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris_long</span> <span class="op">=</span> <span class="va">iris</span> |&gt; <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"Sepal|Petal"</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">name</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"part"</span>, <span class="st">"measurement"</span><span class="op">)</span><span class="op">)</span>
<span class="va">iris_long</span>
<span class="co">#&gt; # A tibble: 600 × 4</span>
<span class="co">#&gt;    Species part  measurement value</span>
<span class="co">#&gt;    &lt;fct&gt;   &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt;  1 setosa  Sepal Length        5.1</span>
<span class="co">#&gt;  2 setosa  Sepal Width         3.5</span>
<span class="co">#&gt;  3 setosa  Petal Length        1.4</span>
<span class="co">#&gt;  4 setosa  Petal Width         0.2</span>
<span class="co">#&gt;  5 setosa  Sepal Length        4.9</span>
<span class="co">#&gt;  6 setosa  Sepal Width         3  </span>
<span class="co">#&gt;  7 setosa  Petal Length        1.4</span>
<span class="co">#&gt;  8 setosa  Petal Width         0.2</span>
<span class="co">#&gt;  9 setosa  Sepal Length        4.7</span>
<span class="co">#&gt; 10 setosa  Sepal Width         3.2</span>
<span class="co">#&gt; # … with 590 more rows</span></code></pre></div>
<p>記述統計ととり方も変わります。
グループ化してから平均値、標準偏差、標準誤差を求めます。</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">irisout</span> <span class="op">=</span> <span class="va">iris_long</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">part</span>, <span class="va">measurement</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="va">value</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">mean</span>, sd <span class="op">=</span> <span class="va">sd</span>, se <span class="op">=</span> <span class="va">se</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">irisout</span>
<span class="co">#&gt; # A tibble: 4 × 5</span>
<span class="co">#&gt; # Groups:   part [2]</span>
<span class="co">#&gt;   part  measurement value_mean value_sd value_se</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Petal Length            3.76    1.77    0.144 </span>
<span class="co">#&gt; 2 Petal Width             1.20    0.762   0.0622</span>
<span class="co">#&gt; 3 Sepal Length            5.84    0.828   0.0676</span>
<span class="co">#&gt; 4 Sepal Width             3.06    0.436   0.0356</span></code></pre></div>
<ul>
<li>H<sub>0</sub>: 花びらと萼片の幅に違いがない</li>
<li>H<sub>A</sub>: 花びらと萼片の幅に違いがある</li>
</ul>
<p>長さと幅のデータが混ざっているので、幅のデータのフィルターを掛けてから解析します。</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris_width</span> <span class="op">=</span> <span class="va">iris_long</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">measurement</span>, <span class="st">"Width"</span><span class="op">)</span><span class="op">)</span>
<span class="va">iris_width</span>
<span class="co">#&gt; # A tibble: 300 × 4</span>
<span class="co">#&gt;    Species part  measurement value</span>
<span class="co">#&gt;    &lt;fct&gt;   &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt;  1 setosa  Sepal Width         3.5</span>
<span class="co">#&gt;  2 setosa  Petal Width         0.2</span>
<span class="co">#&gt;  3 setosa  Sepal Width         3  </span>
<span class="co">#&gt;  4 setosa  Petal Width         0.2</span>
<span class="co">#&gt;  5 setosa  Sepal Width         3.2</span>
<span class="co">#&gt;  6 setosa  Petal Width         0.2</span>
<span class="co">#&gt;  7 setosa  Sepal Width         3.1</span>
<span class="co">#&gt;  8 setosa  Petal Width         0.2</span>
<span class="co">#&gt;  9 setosa  Sepal Width         3.6</span>
<span class="co">#&gt; 10 setosa  Petal Width         0.2</span>
<span class="co">#&gt; # … with 290 more rows</span></code></pre></div>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">part</span>, data <span class="op">=</span> <span class="va">iris_width</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Welch Two Sample t-test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  value by part</span>
<span class="co">#&gt; t = -25.916, df = 237.03, p-value &lt; 2.2e-16</span>
<span class="co">#&gt; alternative hypothesis: true difference in means between group Petal and group Sepal is not equal to 0</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  -1.999237 -1.716763</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; mean in group Petal mean in group Sepal </span>
<span class="co">#&gt;            1.199333            3.057333</span></code></pre></div>
<p>幅の解析をしても、P &lt; 0.0001 なので、帰無仮説を棄却できます。</p>
</div>
<div id="map-関数を用いて解析する" class="section level2" number="6.5">
<h2>
<span class="header-section-number">6.5</span> <code>map()</code> 関数を用いて解析する<a class="anchor" aria-label="anchor" href="#map-%E9%96%A2%E6%95%B0%E3%82%92%E7%94%A8%E3%81%84%E3%81%A6%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h2>
<p>上に紹介した解析は長さと幅に分けてから実施したが、<code>tidyverse</code> の機能を上手につかば最低限のコードでできます。</p>
<p><code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>関数の詳細は専用の章に説明しています (<a href="map-function.html#map-function">5</a>)。</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris_long</span> <span class="op">=</span> <span class="va">iris</span> |&gt; <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"Sepal|Petal"</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">name</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"part"</span>, <span class="st">"measurement"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><code><a href="https://dplyr.tidyverse.org/reference/group_nest.html">group_nest()</a></code> を使って、データのグループ化とネスティングをします。</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris_long</span> <span class="op">=</span> <span class="va">iris_long</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_nest.html">group_nest</a></span><span class="op">(</span><span class="va">measurement</span><span class="op">)</span>
<span class="va">iris_long</span>
<span class="co">#&gt; # A tibble: 2 × 2</span>
<span class="co">#&gt;   measurement               data</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;list&lt;tibble[,3]&gt;&gt;</span>
<span class="co">#&gt; 1 Length               [300 × 3]</span>
<span class="co">#&gt; 2 Width                [300 × 3]</span></code></pre></div>
<p>これで、<code>iris_long</code> の <code>tibble</code> は2つの 300 x 3 <code>tibble</code>に分離しました。
解析は <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> を通して実施します。</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">runttest</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">part</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">iris_long</span> <span class="op">=</span> <span class="va">iris_long</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>tout <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">runttest</span><span class="op">)</span><span class="op">)</span>
<span class="va">iris_long</span>
<span class="co">#&gt; # A tibble: 2 × 3</span>
<span class="co">#&gt;   measurement               data tout   </span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;list&lt;tibble[,3]&gt;&gt; &lt;list&gt; </span>
<span class="co">#&gt; 1 Length               [300 × 3] &lt;htest&gt;</span>
<span class="co">#&gt; 2 Width                [300 × 3] &lt;htest&gt;</span></code></pre></div>
<p>結果は <code>tout</code> に入っています。</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span>

<span class="va">iris_long</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>tout <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">tout</span>, <span class="va">tidy</span><span class="op">)</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">tout</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 × 12</span>
<span class="co">#&gt;   measurement              data estimate estimate1 estimate2</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;list&lt;tibble[,3]&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Length              [300 × 3]    -2.09      3.76      5.84</span>
<span class="co">#&gt; 2 Width               [300 × 3]    -1.86      1.20      3.06</span>
<span class="co">#&gt; # … with 7 more variables: statistic &lt;dbl&gt;, p.value &lt;dbl&gt;,</span>
<span class="co">#&gt; #   parameter &lt;dbl&gt;, conf.low &lt;dbl&gt;, conf.high &lt;dbl&gt;,</span>
<span class="co">#&gt; #   method &lt;chr&gt;, alternative &lt;chr&gt;</span></code></pre></div>
</div>
<div id="種ごとの比較" class="section level2" number="6.6">
<h2>
<span class="header-section-number">6.6</span> 種ごとの比較<a class="anchor" aria-label="anchor" href="#%E7%A8%AE%E3%81%94%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83"><i class="fas fa-link"></i></a>
</h2>
<p>検証する帰無仮説は</p>
<ul>
<li>H<sub>0</sub>: 種間の花びらの長さに違いがないまたは、萼片の幅に違いがない</li>
<li>H<sub>A</sub>: 種間の花びらの長さに違いがあるまたは、萼片の幅に違いがある</li>
</ul>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris_long</span> <span class="op">=</span> <span class="va">iris</span> |&gt; <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"Sepal|Petal"</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">name</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"part"</span>, <span class="st">"measurement"</span><span class="op">)</span><span class="op">)</span>

<span class="va">runmultttest</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span>
  <span class="co">#t12: setosa - versicolor</span>
  <span class="co">#t13: setosa - virginica</span>
  <span class="co">#t23: versicolor - virginica</span>
   
  <span class="va">t12</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">part</span>, data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">Species</span>, <span class="st">"set|ver"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">t13</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">part</span>, data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">Species</span>, <span class="st">"set|vir"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">t23</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">part</span>, data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">Species</span>, <span class="st">"ver|vir"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="st">"setosa vs. versicolor"</span> <span class="op">=</span> <span class="va">t12</span>, 
            <span class="st">"setosa vs. virginica"</span> <span class="op">=</span> <span class="va">t13</span>, 
            <span class="st">"versicolor vs. virginica"</span> <span class="op">=</span> <span class="va">t23</span>, .id <span class="op">=</span> <span class="st">"comparison"</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">iris_long</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_nest.html">group_nest</a></span><span class="op">(</span><span class="va">measurement</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>tout <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">runmultttest</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">tout</span><span class="op">)</span> 
<span class="co">#&gt; # A tibble: 6 × 13</span>
<span class="co">#&gt;   measurement             data comparison estimate estimate1</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;list&lt;tibble[,3&gt; &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Length             [300 × 3] setosa vs…    -2.61     2.86 </span>
<span class="co">#&gt; 2 Length             [300 × 3] setosa vs…    -2.29     3.51 </span>
<span class="co">#&gt; 3 Length             [300 × 3] versicolo…    -1.36     4.91 </span>
<span class="co">#&gt; 4 Width              [300 × 3] setosa vs…    -2.31     0.786</span>
<span class="co">#&gt; 5 Width              [300 × 3] setosa vs…    -2.07     1.14 </span>
<span class="co">#&gt; 6 Width              [300 × 3] versicolo…    -1.20     1.68 </span>
<span class="co">#&gt; # … with 8 more variables: estimate2 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   statistic &lt;dbl&gt;, p.value &lt;dbl&gt;, parameter &lt;dbl&gt;,</span>
<span class="co">#&gt; #   conf.low &lt;dbl&gt;, conf.high &lt;dbl&gt;, method &lt;chr&gt;,</span>
<span class="co">#&gt; #   alternative &lt;chr&gt;</span></code></pre></div>
<p>すべての t 検定に対して、P &lt; 0.0001 でした。
よって、帰無仮説を棄却できます。
ところが、このように複数の組み合わせで検定をすることで、第1種の誤りを起こすことがあります。</p>
<p>第1種の誤差とは、帰無仮説が事実であるのに、棄却する誤りです。
第1種の誤りを起こす確率は有意水準と同じです（<span class="math inline">\(\alpha\)</span>）。
つまり、$= $ 0.05 にした場合、第1種の誤りを起こす確率は 0.5 です。</p>
<p>第1種の誤りは検定の回数によって上昇します。</p>
<p><span class="math display">\[
\text{Type-I error rate} = 1 - (1-\alpha)^n
\]</span></p>
<p>アヤメの解析の場合、種間の比較は 3 回実施したので、第1種の誤りは、</p>
<p><span class="math display">\[
1 - (1-0.05)^3 = 0.142625
\]</span>
です。</p>
<p>有意水準を厳しくすることで誤りの確率を抑えることができます。
例えば、全体の第1種の誤りを 0.05 に抑えたい場合、ここの検定の有意水準を小さくします。</p>
<p><span class="math display">\[
1 - (1 + 0.05)^{1/3} = 0.01695243
\]</span>
つまり、ここの検定の有意水準を 0.016 にすれば、第1種の誤りは 0.047 に抑えられます。
それにしても、このような <strong>多重比較</strong> は専用の解析手法があります。
複数群の平均値が統計学的に違うかを検証したい場合は分散分析のような線形解析を実施します。
最初から複数群のペアごとの違いを検証したいなら、多重比較の検定法を使用します。</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="map-function.html"><span class="header-section-number">5</span> map 関数ってすごい</a></div>
<div class="next"><a href="anova.html"><span class="header-section-number">7</span> 分散分析</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#t-test"><span class="header-section-number">6</span> t 検定</a></li>
<li><a class="nav-link" href="#%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8-5"><span class="header-section-number">6.1</span> 必要なパッケージ</a></li>
<li><a class="nav-link" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E6%BA%96%E5%82%99-2"><span class="header-section-number">6.2</span> データの準備</a></li>
<li><a class="nav-link" href="#petal-%E3%81%A8-sepal-%E3%81%AE%E9%95%B7%E3%81%95%E3%81%AE%E6%AF%94%E8%BC%83"><span class="header-section-number">6.3</span> Petal と Sepal の長さの比較</a></li>
<li><a class="nav-link" href="#petal-%E3%81%A8-sepal-%E3%81%AE%E5%B9%85%E3%81%AE%E6%AF%94%E8%BC%83"><span class="header-section-number">6.4</span> Petal と Sepal の幅の比較</a></li>
<li><a class="nav-link" href="#map-%E9%96%A2%E6%95%B0%E3%82%92%E7%94%A8%E3%81%84%E3%81%A6%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B"><span class="header-section-number">6.5</span> map() 関数を用いて解析する</a></li>
<li><a class="nav-link" href="#%E7%A8%AE%E3%81%94%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83"><span class="header-section-number">6.6</span> 種ごとの比較</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/gnishihara/Lab-Manual/blob/master/20-analysis-ttest.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/gnishihara/Lab-Manual/edit/master/20-analysis-ttest.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>データ解析マニュアル</strong>" was written by 水圏植物生態学研究室. It was last built on 2022-04-28.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
