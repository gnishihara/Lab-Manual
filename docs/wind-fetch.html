<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 14 送風距離 (フェッチ, wind fetch ) | データ解析マニュアル</title>
<meta name="author" content="水圏植物生態学研究室 (greg nishihara)">
<meta name="description" content="海藻は沿岸域における波あたりの強さによって、種数と主構成が変わります16。 波あたりは外界に面した開放性の評価、生物の分布を用いた評価 (biological exposure scale, Burrows et al.、17 地図を用いて方位ごとの対岸距離 (fetch) を求める、観測機器を設置して波あたりの力や波高などの観測が主な評価方法です18。 ここでは、fetch, とくに...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="Chapter 14 送風距離 (フェッチ, wind fetch ) | データ解析マニュアル">
<meta property="og:type" content="book">
<meta property="og:description" content="海藻は沿岸域における波あたりの強さによって、種数と主構成が変わります16。 波あたりは外界に面した開放性の評価、生物の分布を用いた評価 (biological exposure scale, Burrows et al.、17 地図を用いて方位ごとの対岸距離 (fetch) を求める、観測機器を設置して波あたりの力や波高などの観測が主な評価方法です18。 ここでは、fetch, とくに...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 14 送風距離 (フェッチ, wind fetch ) | データ解析マニュアル">
<meta name="twitter:description" content="海藻は沿岸域における波あたりの強さによって、種数と主構成が変わります16。 波あたりは外界に面した開放性の評価、生物の分布を用いた評価 (biological exposure scale, Burrows et al.、17 地図を用いて方位ごとの対岸距離 (fetch) を求める、観測機器を設置して波あたりの力や波高などの観測が主な評価方法です18。 ここでは、fetch, とくに...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">データ解析マニュアル</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">このマニュアルについて</a></li>
<li><a class="" href="data-input.html"><span class="header-section-number">1</span> データの読み込み</a></li>
<li><a class="" href="data-wrangling.html"><span class="header-section-number">2</span> データの処理</a></li>
<li><a class="" href="data-logger-input.html"><span class="header-section-number">3</span> ロガーからの読み込み</a></li>
<li><a class="" href="data-summary.html"><span class="header-section-number">4</span> データの集計</a></li>
<li><a class="" href="map-function.html"><span class="header-section-number">5</span> map 関数ってすごい</a></li>
<li><a class="" href="t-test.html"><span class="header-section-number">6</span> t 検定</a></li>
<li><a class="" href="anova.html"><span class="header-section-number">7</span> 分散分析</a></li>
<li><a class="" href="linear-models.html"><span class="header-section-number">8</span> 線形モデル</a></li>
<li><a class="" href="gam.html"><span class="header-section-number">9</span> 一般化加法モデル</a></li>
<li><a class="" href="model-selection.html"><span class="header-section-number">10</span> モデル選択</a></li>
<li><a class="" href="non-linear-model01.html"><span class="header-section-number">11</span> 非線形モデル-I</a></li>
<li><a class="" href="ggplot.html"><span class="header-section-number">12</span> ggplot</a></li>
<li><a class="" href="maps.html"><span class="header-section-number">13</span> 地図の作り方</a></li>
<li><a class="active" href="wind-fetch.html"><span class="header-section-number">14</span> 送風距離 (フェッチ, wind fetch )</a></li>
<li><a class="" href="redundancy-analysis.html"><span class="header-section-number">15</span> 冗長性分析 (RDA)</a></li>
<li><a class="" href="wavelet.html"><span class="header-section-number">16</span> Wavelet 解析</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/gnishihara/Lab-Manual">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="wind-fetch" class="section level1" number="14">
<h1>
<span class="header-section-number">14</span> 送風距離 (フェッチ, wind fetch )<a class="anchor" aria-label="anchor" href="#wind-fetch"><i class="fas fa-link"></i></a>
</h1>
<p>海藻は沿岸域における波あたりの強さによって、種数と主構成が変わります<span class="citation"><a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a></span>。
波あたりは外界に面した開放性の評価、生物の分布を用いた評価 (biological exposure scale, Burrows et al.、<span class="citation"><a href="#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a></span>
地図を用いて方位ごとの対岸距離 (fetch) を求める、観測機器を設置して波あたりの力や波高などの観測が主な評価方法です<span class="citation"><a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a></span>。</p>
<p>ここでは、fetch, とくに wind fetch （送風距離）の評価方法を消化します。
波あたりの強さを、生物の分布を用いて評価した場合、波あたりと生物の関係の説明は循環論になります。</p>
<p>送風距離の関数は <a href="https://github.com/blasee/fetchR"><code>blasee/fetchR</code></a> を参考にしました。</p>
<div id="必要なパッケージ-11" class="section level2" number="14.1">
<h2>
<span class="header-section-number">14.1</span> 必要なパッケージ<a class="anchor" aria-label="anchor" href="#%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8-11"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb279"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/magick/">magick</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel">ggrepel</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yixuan/showtext">showtext</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="送風距離関数の定義" class="section level2" number="14.2">
<h2>
<span class="header-section-number">14.2</span> 送風距離関数の定義<a class="anchor" aria-label="anchor" href="#%E9%80%81%E9%A2%A8%E8%B7%9D%E9%9B%A2%E9%96%A2%E6%95%B0%E3%81%AE%E5%AE%9A%E7%BE%A9"><i class="fas fa-link"></i></a>
</h2>
<p>詳細の原因はわかりませんが、<code>fetchR</code> の関数は国土交通省・国土数値情報
のシェープファイルと合わなかったので、ここで再定義しています。</p>
<p>最大円は <code>calc_circle()</code> で求めます。
<code>map_layer</code> に起点の <code>sf</code> オブジェクトを渡します。
<code>max_dist</code> に最大円の半径を渡します。このときの他には km です。
<code>n_vectors</code> は象限あたりの方位の数です。</p>
<div class="sourceCode" id="cb280"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">calc_circle</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">map_layer</span>, <span class="va">max_dist</span> <span class="op">=</span> <span class="fl">30</span>, <span class="va">n_vectors</span> <span class="op">=</span> <span class="fl">9</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Calculate the fetch limits.</span>
  <span class="co"># max_dist in kilometers</span>
  <span class="va">delta_theta</span> <span class="op">=</span>  <span class="fl">360</span> <span class="op">/</span> <span class="op">(</span><span class="va">n_vectors</span> <span class="op">*</span> <span class="fl">4</span><span class="op">)</span>
  <span class="va">theta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">360</span>, by <span class="op">=</span> <span class="va">delta_theta</span><span class="op">)</span>
  <span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>
  <span class="va">theta</span> <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="op">-</span><span class="va">n</span><span class="op">]</span>
  <span class="va">max_dist</span> <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/units/man/units.html">set_units</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">*</span><span class="va">max_dist</span>, <span class="st">"m"</span><span class="op">)</span>
  <span class="va">fetch_circle</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_buffer</a></span><span class="op">(</span><span class="va">map_layer</span>, dist <span class="op">=</span> <span class="va">max_dist</span>, nQuadSegs <span class="op">=</span> <span class="va">n_vectors</span><span class="op">)</span> 
  <span class="va">fetch_limits</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">fetch_circle</span><span class="op">)</span>
  <span class="va">fetch_limits</span> <span class="op">=</span> <span class="va">fetch_limits</span><span class="op">[</span><span class="op">-</span><span class="va">n</span>, <span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fetch_circle <span class="op">=</span> <span class="va">fetch_circle</span>, fetch_limits <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">fetch_limits</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span> <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><code>calc_intersection()</code> は起点からフェッチの最大円まで直線を引きます。
最大円内に交差したポリゴンの交差点を特定し、起点に一番近い交差点を返します。
交差点が内場合は、最大円までの距離を返します。
これらの関数は <code>tidyverse</code> や <code>sf</code> が必要です。</p>
<div class="sourceCode" id="cb281"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">calc_intersection</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">fetch_limit</span>, <span class="va">origin</span>, <span class="va">map_layer</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">origin</span><span class="op">)</span>, <span class="va">fetch_limit</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">fetch_vector</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">map_layer</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fetch_intersection</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html">st_intersection</a></span><span class="op">(</span><span class="va">fetch_vector</span>, <span class="va">map_layer</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html">st_cast</a></span><span class="op">(</span><span class="st">"POINT"</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">fetch_intersection</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">intersection_coordinate</span>  <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">fetch_intersection</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span>
    <span class="va">distance_from_origin</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_distance</a></span><span class="op">(</span><span class="va">origin</span>, <span class="va">fetch_intersection</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="op">)</span>
    <span class="va">closest_intersection</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">distance_from_origin</span><span class="op">)</span>
    <span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/near.html">near</a></span><span class="op">(</span><span class="va">distance_from_origin</span>, <span class="va">closest_intersection</span><span class="op">)</span><span class="op">)</span> 
    <span class="va">intersection_coordinate</span> <span class="op">=</span> <span class="va">intersection_coordinate</span><span class="op">[</span><span class="va">n</span>,<span class="op">]</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="va">intersection_coordinate</span>  <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">fetch_limit</span><span class="op">)</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">map_layer</span><span class="op">)</span><span class="op">)</span>
    <span class="va">distance_from_origin</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_distance</a></span><span class="op">(</span><span class="va">origin</span>, <span class="va">intersection_coordinate</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="op">)</span>
    <span class="va">closest_intersection</span> <span class="op">=</span> <span class="va">distance_from_origin</span>
    <span class="va">intersection_coordinate</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">intersection_coordinate</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">origin</span><span class="op">)</span>, <span class="va">intersection_coordinate</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span><span class="cn">T</span><span class="op">)</span>
  <span class="va">fetch_vector</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">map_layer</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fetch_length</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_length</a></span><span class="op">(</span><span class="va">fetch_vector</span><span class="op">)</span> 
  <span class="va">fetch_vector</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>length <span class="op">=</span> <span class="va">fetch_length</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb282"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">################################################################################</span>
<span class="co"># Prepare data set #############################################################</span>
<span class="co"># GPS coordinates to determine wind fetcj ######################################</span>
<span class="va">matsushimagps</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">38.34549669653925</span>, <span class="fl">141.0807915733725</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">hirotagps</span>     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">39.02402594131857</span>, <span class="fl">141.78725806724896</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">bisegps</span>       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">26.704302654710496</span>, <span class="fl">127.85974269102186</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">arikawagps</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">32.98827976845565</span>, <span class="fl">129.11838896005543</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co"># arikawagps    = matrix(rev(c(32.99602966223495, 129.11335509246598)), ncol = 2) # For Fetch calcs</span>
<span class="va">tainouragps</span>   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">32.95134175383013</span>, <span class="fl">129.1096027426365</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">omuragps</span>      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">32</span><span class="op">+</span><span class="fl">52</span><span class="op">/</span><span class="fl">60</span><span class="op">+</span><span class="fl">11.9</span><span class="op">/</span><span class="fl">60</span><span class="op">/</span><span class="fl">60</span>, <span class="fl">129</span><span class="op">+</span><span class="fl">58</span><span class="op">/</span><span class="fl">60</span><span class="op">+</span><span class="fl">24.5</span><span class="op">/</span><span class="fl">60</span><span class="op">/</span><span class="fl">60</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="va">gps_info</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">matsushimagps</span>, <span class="va">hirotagps</span>, <span class="va">bisegps</span>, <span class="va">arikawagps</span>, <span class="va">tainouragps</span>, <span class="va">omuragps</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"matsushimagps"</span>, <span class="st">"hirotagps"</span>, <span class="st">"bisegps"</span>, <span class="st">"arikawagps"</span>, <span class="st">"tainouragps"</span>, <span class="st">"omuragps"</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_sentence</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">name</span>, pattern <span class="op">=</span> <span class="st">"(gps)"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>long <span class="op">=</span> <span class="va">V1</span>, lat <span class="op">=</span> <span class="va">V2</span><span class="op">)</span>

<span class="va">gps_info</span> <span class="op">=</span> <span class="va">gps_info</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>label2 <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_sentence</a></span><span class="op">(</span><span class="va">label</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>label2 <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{label2} {ifelse(str_detect(label2, 'Bise'), 'Point', 'Bay')}"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Prepare the Coordinate Reference System to be EPSG:4326 (Which is WGS 84)</span>
<span class="co"># See st_crs(4326) for details</span>
<span class="va">gps_info</span> <span class="op">=</span> <span class="va">gps_info</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">long</span>, <span class="va">lat</span>, <span class="va">name</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"long"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span>, agr <span class="op">=</span> <span class="st">"constant"</span><span class="op">)</span>

<span class="co"># Load the map shape files #####################################################</span>
<span class="co"># The map uses the ITRF94 system (st_crs(map_poly))</span>
<span class="co"># gsi_low = read_sf("~/Lab_Data/Japan_map_data/GSI/coastl_jpn.shp")</span>
<span class="co"># gsi_low = read_sf("~/Lab_Data/Japan_map_data/GADM_old/JPN_adm1.shp")</span>
<span class="va">map_poly</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="st">"~/Lab_Data/Japan_map_data/GSI/polbnda_jpn.shp"</span><span class="op">)</span>
<span class="va">map_poly</span> <span class="op">=</span> <span class="va">map_poly</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">nam</span>, <span class="va">geometry</span><span class="op">)</span>

<span class="co"># Convert the CRS to EPSG:2450 #################################################</span>
<span class="va">map_poly</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">map_poly</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="fl">2450</span><span class="op">)</span><span class="op">)</span>
<span class="va">gps_info</span>  <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">gps_info</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="fl">2450</span><span class="op">)</span><span class="op">)</span>

<span class="co">################################################################################</span>
<span class="co"># Do the analysis one location at a time. ######################################</span>
<span class="va">ptsize</span> <span class="op">=</span> <span class="fl">1</span>
<span class="va">max_dist</span> <span class="op">=</span> <span class="fl">10</span> <span class="co"># In km</span>
<span class="va">n_vectors</span> <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="fl">9</span> <span class="co"># The number of vectors in every quadrant.</span>

<span class="va">location</span> <span class="op">=</span> <span class="st">"Hirota Bay"</span>
<span class="va">polygon_layer</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">map_poly</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">nam</span>, <span class="st">"Iwate"</span><span class="op">)</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="op">)</span> 
<span class="va">site_layer</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">gps_info</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"hiro"</span><span class="op">)</span><span class="op">)</span>
<span class="va">fetch_limits</span> <span class="op">=</span> <span class="fu">calc_circle</span><span class="op">(</span><span class="va">site_layer</span>, max_dist <span class="op">=</span> <span class="va">max_dist</span>, n_vectors <span class="op">=</span> <span class="va">n_vectors</span><span class="op">)</span>
<span class="va">fout</span> <span class="op">=</span> <span class="va">fetch_limits</span><span class="op">$</span><span class="va">fetch_limits</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fe  <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">Y</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">fe</span>, <span class="va">calc_intersection</span>, origin <span class="op">=</span> <span class="va">site_layer</span>, map_layer <span class="op">=</span> <span class="va">polygon_layer</span><span class="op">)</span><span class="op">)</span>
<span class="va">fout</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span> |&gt;  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">temp_layer</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span><span class="va">polygon_layer</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">fetch_limits</span><span class="op">$</span><span class="va">fetch_circle</span><span class="op">)</span><span class="op">)</span>
<span class="va">mean_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">sd_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">max_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">man_n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/near.html">near</a></span><span class="op">(</span><span class="va">max_fetch</span>, <span class="va">max_dist</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span>
<span class="va">tot_n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">max_fetch</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">temp_layer</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fout</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">site_layer</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="va">ptsize</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"The mean ± sd fetch for {location} is {format(mean_fetch, digits = 4)} ± {format(sd_fetch, digits = 4)} m."</span><span class="op">)</span>,
       subtitle <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{man_n} out of {tot_n} vectors were at the upper limit."</span><span class="op">)</span><span class="op">)</span>

<span class="va">location</span> <span class="op">=</span> <span class="st">"Matsushima Bay"</span>
<span class="va">polygon_layer</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">map_poly</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">nam</span>, <span class="st">"Miyag"</span><span class="op">)</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="op">)</span> 
<span class="va">site_layer</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">gps_info</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"matsu"</span><span class="op">)</span><span class="op">)</span>
<span class="va">fetch_limits</span> <span class="op">=</span> <span class="fu">calc_circle</span><span class="op">(</span><span class="va">site_layer</span>, max_dist <span class="op">=</span> <span class="va">max_dist</span>, n_vectors <span class="op">=</span> <span class="va">n_vectors</span><span class="op">)</span>
<span class="va">fout</span> <span class="op">=</span> <span class="va">fetch_limits</span><span class="op">$</span><span class="va">fetch_limits</span> |&gt; <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fe  <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">Y</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">fe</span>, <span class="va">calc_intersection</span>, origin <span class="op">=</span> <span class="va">site_layer</span>, map_layer <span class="op">=</span> <span class="va">polygon_layer</span><span class="op">)</span><span class="op">)</span>
<span class="va">fout</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span> |&gt;  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">temp_layer</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span><span class="va">polygon_layer</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">fetch_limits</span><span class="op">$</span><span class="va">fetch_circle</span><span class="op">)</span><span class="op">)</span>
<span class="va">mean_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">sd_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">max_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">man_n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/near.html">near</a></span><span class="op">(</span><span class="va">max_fetch</span>, <span class="va">max_dist</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span>
<span class="va">tot_n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">max_fetch</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">temp_layer</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fout</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">site_layer</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="va">ptsize</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"The mean ± sd fetch for {location} is {format(mean_fetch, digits = 4)} ± {format(sd_fetch, digits = 4)} m."</span><span class="op">)</span>,
       subtitle <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{man_n} out of {tot_n} vectors were at the upper limit."</span><span class="op">)</span><span class="op">)</span>

<span class="va">location</span> <span class="op">=</span> <span class="st">"Bise Point"</span>
<span class="va">polygon_layer</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">map_poly</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">nam</span>, <span class="st">"Okinawa"</span><span class="op">)</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="op">)</span> 
<span class="va">site_layer</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">gps_info</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"bise"</span><span class="op">)</span><span class="op">)</span>
<span class="va">fetch_limits</span> <span class="op">=</span> <span class="fu">calc_circle</span><span class="op">(</span><span class="va">site_layer</span>, max_dist <span class="op">=</span> <span class="va">max_dist</span>, n_vectors <span class="op">=</span> <span class="va">n_vectors</span><span class="op">)</span>
<span class="va">fout</span> <span class="op">=</span> <span class="va">fetch_limits</span><span class="op">$</span><span class="va">fetch_limits</span> |&gt; <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fe  <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">Y</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">fe</span>, <span class="va">calc_intersection</span>, origin <span class="op">=</span> <span class="va">site_layer</span>, map_layer <span class="op">=</span> <span class="va">polygon_layer</span><span class="op">)</span><span class="op">)</span>
<span class="va">fout</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span> |&gt;  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">temp_layer</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span><span class="va">polygon_layer</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">fetch_limits</span><span class="op">$</span><span class="va">fetch_circle</span><span class="op">)</span><span class="op">)</span>
<span class="va">mean_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">sd_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">max_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">man_n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/near.html">near</a></span><span class="op">(</span><span class="va">max_fetch</span>, <span class="va">max_dist</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span>
<span class="va">tot_n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">max_fetch</span><span class="op">)</span>

<span class="va">p3</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">temp_layer</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fout</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">site_layer</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="va">ptsize</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"The mean ± sd fetch for {location} is {format(mean_fetch, digits = 4)} ± {format(sd_fetch, digits = 4)} m."</span><span class="op">)</span>,
       subtitle <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{man_n} out of {tot_n} vectors were at the upper limit."</span><span class="op">)</span><span class="op">)</span>

<span class="va">location</span> <span class="op">=</span> <span class="st">"Omura Bay"</span>
<span class="va">polygon_layer</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">map_poly</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">nam</span>, <span class="st">"Nagasaki"</span><span class="op">)</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="op">)</span> 
<span class="va">site_layer</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">gps_info</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"omura"</span><span class="op">)</span><span class="op">)</span>
<span class="va">fetch_limits</span> <span class="op">=</span> <span class="fu">calc_circle</span><span class="op">(</span><span class="va">site_layer</span>, max_dist <span class="op">=</span> <span class="va">max_dist</span>, n_vectors <span class="op">=</span> <span class="va">n_vectors</span><span class="op">)</span>
<span class="va">fout</span> <span class="op">=</span> <span class="va">fetch_limits</span><span class="op">$</span><span class="va">fetch_limits</span> |&gt; <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fe  <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">Y</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">fe</span>, <span class="va">calc_intersection</span>, origin <span class="op">=</span> <span class="va">site_layer</span>, map_layer <span class="op">=</span> <span class="va">polygon_layer</span><span class="op">)</span><span class="op">)</span>
<span class="va">fout</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span> |&gt;  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">temp_layer</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span><span class="va">polygon_layer</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">fetch_limits</span><span class="op">$</span><span class="va">fetch_circle</span><span class="op">)</span><span class="op">)</span>
<span class="va">mean_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">sd_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">max_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">man_n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/near.html">near</a></span><span class="op">(</span><span class="va">max_fetch</span>, <span class="va">max_dist</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span>
<span class="va">tot_n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">max_fetch</span><span class="op">)</span>

<span class="va">p4</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">temp_layer</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fout</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">site_layer</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="va">ptsize</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"The mean ± sd fetch for {location} is {format(mean_fetch, digits = 4)} ± {format(sd_fetch, digits = 4)} m."</span><span class="op">)</span>,
       subtitle <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{man_n} out of {tot_n} vectors were at the upper limit."</span><span class="op">)</span><span class="op">)</span>

<span class="va">location</span> <span class="op">=</span> <span class="st">"Arikawa Bay"</span>
<span class="va">polygon_layer</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">map_poly</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">nam</span>, <span class="st">"Nagasaki"</span><span class="op">)</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="op">)</span> 
<span class="va">site_layer</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">gps_info</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"arik"</span><span class="op">)</span><span class="op">)</span>
<span class="va">fetch_limits</span> <span class="op">=</span> <span class="fu">calc_circle</span><span class="op">(</span><span class="va">site_layer</span>, max_dist <span class="op">=</span> <span class="va">max_dist</span>, n_vectors <span class="op">=</span> <span class="va">n_vectors</span><span class="op">)</span>
<span class="va">fout</span> <span class="op">=</span> <span class="va">fetch_limits</span><span class="op">$</span><span class="va">fetch_limits</span> |&gt; <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fe  <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">Y</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">fe</span>, <span class="va">calc_intersection</span>, origin <span class="op">=</span> <span class="va">site_layer</span>, map_layer <span class="op">=</span> <span class="va">polygon_layer</span><span class="op">)</span><span class="op">)</span>
<span class="va">fout</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span> |&gt;  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">temp_layer</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span><span class="va">polygon_layer</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">fetch_limits</span><span class="op">$</span><span class="va">fetch_circle</span><span class="op">)</span><span class="op">)</span>
<span class="va">mean_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">sd_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">max_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">man_n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/near.html">near</a></span><span class="op">(</span><span class="va">max_fetch</span>, <span class="va">max_dist</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span>
<span class="va">tot_n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">max_fetch</span><span class="op">)</span>

<span class="va">p5</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">temp_layer</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fout</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">site_layer</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="va">ptsize</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"The mean ± sd fetch for {location} is {format(mean_fetch, digits = 4)} ± {format(sd_fetch, digits = 4)} m."</span><span class="op">)</span>,
       subtitle <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{man_n} out of {tot_n} vectors were at the upper limit."</span><span class="op">)</span><span class="op">)</span>

<span class="va">location</span> <span class="op">=</span> <span class="st">"Tainoura Bay"</span>
<span class="va">polygon_layer</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">map_poly</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">nam</span>, <span class="st">"Nagasaki"</span><span class="op">)</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="op">)</span> 
<span class="va">site_layer</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">gps_info</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"tain"</span><span class="op">)</span><span class="op">)</span>
<span class="va">fetch_limits</span> <span class="op">=</span> <span class="fu">calc_circle</span><span class="op">(</span><span class="va">site_layer</span>, max_dist <span class="op">=</span> <span class="va">max_dist</span>, n_vectors <span class="op">=</span> <span class="va">n_vectors</span><span class="op">)</span>
<span class="va">fout</span> <span class="op">=</span> <span class="va">fetch_limits</span><span class="op">$</span><span class="va">fetch_limits</span> |&gt; <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fe  <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">Y</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">fe</span>, <span class="va">calc_intersection</span>, origin <span class="op">=</span> <span class="va">site_layer</span>, map_layer <span class="op">=</span> <span class="va">polygon_layer</span><span class="op">)</span><span class="op">)</span>
<span class="va">fout</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span> |&gt;  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">temp_layer</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span><span class="va">polygon_layer</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">fetch_limits</span><span class="op">$</span><span class="va">fetch_circle</span><span class="op">)</span><span class="op">)</span>
<span class="va">mean_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">sd_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">max_fetch</span> <span class="op">=</span> <span class="va">fout</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">man_n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/near.html">near</a></span><span class="op">(</span><span class="va">max_fetch</span>, <span class="va">max_dist</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span>
<span class="va">tot_n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">max_fetch</span><span class="op">)</span>

<span class="va">p6</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">temp_layer</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fout</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">site_layer</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="va">ptsize</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"The mean ± sd fetch for {location} is {format(mean_fetch, digits = 4)} ± {format(sd_fetch, digits = 4)} m."</span><span class="op">)</span>,
       subtitle <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{man_n} out of {tot_n} vectors were at the upper limit."</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb283"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p4</span> <span class="op">+</span> <span class="va">p5</span> <span class="op">+</span> <span class="va">p6</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="55-windfetch_files/figure-html/unnamed-chunk-5-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb284"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pdfname</span> <span class="op">=</span> <span class="st">"~/Downloads/Determine_fetch.pdf"</span>
<span class="va">pngname</span> <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">pdfname</span>, <span class="st">"pdf"</span>, <span class="st">"png"</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">pdfname</span>, width <span class="op">=</span> <span class="fl">5</span><span class="op">*</span><span class="fl">80</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">*</span><span class="fl">80</span>, units <span class="op">=</span> <span class="st">"mm"</span><span class="op">)</span>
<span class="va">img</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/magick/reference/editing.html">image_read</a></span><span class="op">(</span><span class="va">pdfname</span>, density <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>
<span class="va">img</span> |&gt; <span class="fu"><a href="https://docs.ropensci.org/magick/reference/editing.html">image_write</a></span><span class="op">(</span><span class="va">pngname</span>, format <span class="op">=</span> <span class="st">"png"</span><span class="op">)</span></code></pre></div>

</div>
</div>
<div class="footnotes">
<hr>
<ol start="16">
<li id="fn16"><p>Gregory N. Nishihara, Ryuta Terada, and Hiromori Shimabukuro, <span>“<span class="nocase">Effects of wave energy on the residence times of a fluorescent tracer in the canopy of the intertidal marine macroalgae, Sargassum fusiforme (Phaeophyceae)</span>,”</span> <em>Phycological Research</em> 59, no. 1 (2011): 24–33, <a href="https://doi.org/10.1111/j.1440-1835.2010.00595.x" role="doc-biblioref">https://doi.org/10.1111/j.1440-1835.2010.00595.x</a>.<a href="wind-fetch.html#fnref16" class="footnote-back">↩︎</a></p></li>
<li id="fn17"><p>Michael T. Burrows, Robin Harvey, and Linda Robb, <span>“<span class="nocase">Wave exposure indices from digital coastlines and the prediction of rocky shore community structure</span>,”</span> <em>Marine Ecology Progress Series</em> 353 (2008), <a href="https://doi.org/10.3354/meps07284" role="doc-biblioref">https://doi.org/10.3354/meps07284</a>.<a href="wind-fetch.html#fnref17" class="footnote-back">↩︎</a></p></li>
<li id="fn18"><p>大垣俊一, <span>“開放度測定の地形法,”</span> <em>Argonauta</em> 16 (2009): 25–38, <a href="http://wgs.mus-nh.city.osaka.jp/iso/argo/nl16/nl16-25-38.pdf" role="doc-biblioref">http://wgs.mus-nh.city.osaka.jp/iso/argo/nl16/nl16-25-38.pdf</a>.<a href="wind-fetch.html#fnref18" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="maps.html"><span class="header-section-number">13</span> 地図の作り方</a></div>
<div class="next"><a href="redundancy-analysis.html"><span class="header-section-number">15</span> 冗長性分析 (RDA)</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#wind-fetch"><span class="header-section-number">14</span> 送風距離 (フェッチ, wind fetch )</a></li>
<li><a class="nav-link" href="#%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8-11"><span class="header-section-number">14.1</span> 必要なパッケージ</a></li>
<li><a class="nav-link" href="#%E9%80%81%E9%A2%A8%E8%B7%9D%E9%9B%A2%E9%96%A2%E6%95%B0%E3%81%AE%E5%AE%9A%E7%BE%A9"><span class="header-section-number">14.2</span> 送風距離関数の定義</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/gnishihara/Lab-Manual/blob/master/55-windfetch.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/gnishihara/Lab-Manual/edit/master/55-windfetch.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>データ解析マニュアル</strong>" was written by 水圏植物生態学研究室 (greg nishihara). It was last built on 2022-05-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
